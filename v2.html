<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- favicon icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%230d6efd'%3E%3Cpath d='M8 1a4 4 0 0 0-4 4v3h8V5a4 4 0 0 0-4-4zM3 8v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V8H3z'/%3E%3C/svg%3E">

    <title>One Time Pad Theory Implementation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body class="bg-light">

    <div class="container py-4">
        <h2 class="text-center mb-4"><i class="bi bi-shield-lock"></i> One Time Pad Theory Implementation</h2>

        <!-- Info Section -->
        <div class="card mb-4 shadow-sm border-info">
            <div class="card-body bg-info bg-opacity-10">
                <h5><i class="bi bi-info-circle"></i> How it Works</h5>
                <p class="mb-1">
                    The <strong>One Time Pad (OTP)</strong> is a symmetric encryption method where
                    each character of the plaintext is XORed with a corresponding character
                    from a random key of the <strong>same length</strong>.
                </p>
                <ul>
                    <li><strong>Encryption:</strong> Plaintext âŠ• Key â†’ Ciphertext (Base64 encoded)</li>
                    <li><strong>Decryption:</strong> Ciphertext âŠ• Key â†’ Original Plaintext</li>
                    <li>The key must be random and used only once for perfect secrecy.</li>
                    <li><strong>Allowed Characters in plaintext:</strong> You can use any ASCII(7-bit) characters including letters(A-Z, a-z), numbers(0-9), symbols(!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~), and spaces.</li>
                </ul>
            </div>
        </div>


        <div class="row g-4">
            <!-- ENCRYPTION -->
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-lock"></i> Encryption
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Plain Text</label>
                            <textarea id="plaintextenc" class="form-control" rows="3"
                                placeholder="Enter text to encrypt"></textarea>
                        </div>

                        <div class="mb-2">
                            <label class="form-label">Key Text</label>
                            <textarea id="keytextenc" class="form-control" rows="3"
                                placeholder="Enter or generate key"></textarea>
                        </div>

                        <!-- Key Strength Indicator -->
                        <div class="progress mb-3" style="height: 8px;">
                            <div id="keyStrengthBar" class="progress-bar bg-danger" style="width: 0%;"></div>
                        </div>

                        <!-- Generate + Download Key Buttons -->
                        <div class="d-flex flex-wrap gap-2 mb-3">
                            <button id="generateKeyBtn" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-shuffle"></i> Generate Random Key
                            </button>
                            <button id="downloadKeyBtn" class="btn btn-sm btn-success d-none">
                                <i class="bi bi-download"></i> Download Key
                            </button>
                        </div>

                        <!-- Character Selection for Random Key -->
                        <div class="mb-3">
                            <div class="small text-muted mb-1"><i class="bi bi-sliders"></i> Include in random key:
                            </div>
                            <div class="border rounded p-2 bg-light">
                                <div class="row g-2 small">
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="upperCheck" checked>
                                            <label class="form-check-label" for="upperCheck">Uppercase (Aâ€“Z)</label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="lowerCheck" checked>
                                            <label class="form-check-label" for="lowerCheck">Lowercase (aâ€“z)</label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="numCheck" checked>
                                            <label class="form-check-label" for="numCheck">Numbers (0â€“9)</label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="symCheck">
                                            <label class="form-check-label" for="symCheck">Symbols
                                                (!@#$%^&amp;*)</label>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="spaceCheck">
                                            <label class="form-check-label" for="spaceCheck">Space ( )</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Encrypt Button -->
                        <div class="text-center mb-3">
                            <button id="encryptBtn" class="btn btn-primary btn-sm" disabled>
                                <i class="bi bi-lock-fill"></i> Encrypt
                            </button>
                        </div>

                        <h6>Result:</h6>
                        <div id="ciphertextdiv" class="border p-2 bg-light rounded" style="min-height: 60px;"></div>

                        <!-- Copy + Download buttons side by side -->
                        <div class="d-flex justify-content-start gap-2 mt-2">
                            <button id="copyCipherBtn" class="btn btn-outline-primary btn-sm d-none">
                                <i class="bi bi-clipboard"></i> Copy Ciphertext
                            </button>
                            <button id="downloadCipherBtn" class="btn btn-outline-success btn-sm d-none">
                                <i class="bi bi-download"></i> Download Ciphertext
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DECRYPTION -->
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-unlock"></i> Decryption
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Cipher Text (Base64)</label>
                            <textarea id="ciphertextdec" class="form-control" rows="3"
                                placeholder="Paste Base64 cipher text"></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Key Text</label>
                            <textarea id="keytextdec" class="form-control" rows="3"
                                placeholder="Enter the same key used in encryption"></textarea>
                        </div>

                        <div class="d-flex flex-wrap gap-2 mb-3">
                            <button id="decryptBtn" class="btn btn-sm btn-success" disabled>
                                <i class="bi bi-unlock-fill"></i> Decrypt
                            </button>
                            <button id="swapBtn" class="btn btn-sm btn-warning">
                                <i class="bi bi-arrow-left-right"></i> Swap Data
                            </button>
                        </div>

                        <h6>Result:</h6>
                        <div id="plaintextdivdec" class="border p-2 bg-light rounded" style="min-height: 60px;"></div>

                        <!-- Copy + Download buttons side by side -->
                        <div class="d-flex justify-content-start gap-2 mt-2">
                            <button id="copyPlainBtn" class="btn btn-outline-primary btn-sm d-none">
                                <i class="bi bi-clipboard"></i> Copy Plaintext
                            </button>
                            <button id="downloadPlainBtn" class="btn btn-outline-success btn-sm d-none">
                                <i class="bi bi-download"></i> Download Plaintext
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999;">
        <div id="liveToast" class="toast align-items-center text-white bg-dark border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastMsg"></div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const plaintextenc = document.getElementById('plaintextenc');
        const keytextenc = document.getElementById('keytextenc');
        const ciphertextdiv = document.getElementById('ciphertextdiv');
        const encryptBtn = document.getElementById('encryptBtn');
        const copyCipherBtn = document.getElementById('copyCipherBtn');
        const downloadCipherBtn = document.getElementById('downloadCipherBtn');
        const downloadKeyBtn = document.getElementById('downloadKeyBtn');
        const keyStrengthBar = document.getElementById('keyStrengthBar');
        const generateKeyBtn = document.getElementById('generateKeyBtn');

        const ciphertextdec = document.getElementById('ciphertextdec');
        const keytextdec = document.getElementById('keytextdec');
        const decryptBtn = document.getElementById('decryptBtn');
        const plaintextdivdec = document.getElementById('plaintextdivdec');
        const copyPlainBtn = document.getElementById('copyPlainBtn');
        const downloadPlainBtn = document.getElementById('downloadPlainBtn');
        const swapBtn = document.getElementById('swapBtn');

        // XOR helper
        function xorCharacters(charA, charB) {
            return String.fromCharCode(charA.charCodeAt(0) ^ charB.charCodeAt(0));
        }

        // Toast
        function showToast(msg) {
            const toastMsg = document.getElementById('toastMsg');
            toastMsg.textContent = msg;
            const toast = new bootstrap.Toast(document.getElementById('liveToast'));
            toast.show();
        }

        // Key strength validation & encrypt button enable
        function validateKeyStrength() {
            const plaintextLen = plaintextenc.value.length;
            const keyLen = keytextenc.value.length;
            const pct = plaintextLen === 0 ? 0 : Math.min((keyLen / plaintextLen) * 100, 100);
            keyStrengthBar.style.width = pct + "%";
            keyStrengthBar.className = "progress-bar " + (pct === 0 ? "bg-danger" : pct < 50 ? "bg-danger" : pct < 100 ? "bg-warning" : "bg-success");
            encryptBtn.disabled = keyLen < plaintextLen || plaintextLen === 0;
        }

        // Generate Random Key with Character Options
        generateKeyBtn.addEventListener('click', () => {
            const length = plaintextenc.value.length;
            if (length === 0) {
                alert("Enter plaintext first!");
                return;
            }

            let charset = '';
            if (document.getElementById('upperCheck').checked) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (document.getElementById('lowerCheck').checked) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (document.getElementById('numCheck').checked) charset += '0123456789';
            if (document.getElementById('symCheck').checked) charset += '!@#$%^&*()_+-={}[]|:;"<>,.?/~`';
            if (document.getElementById('spaceCheck').checked) charset += ' ';

            if (!charset) {
                alert("Please select at least one character type!");
                return;
            }

            let randomKey = '';
            for (let i = 0; i < length; i++) {
                randomKey += charset.charAt(Math.floor(Math.random() * charset.length));
            }

            keytextenc.value = randomKey;
            validateKeyStrength();
            showToast('ðŸ”‘ Random key generated.');
        });

        // Listeners for validation
        plaintextenc.addEventListener('input', validateKeyStrength);
        keytextenc.addEventListener('input', validateKeyStrength);

        // Encrypt
        encryptBtn.addEventListener('click', () => {
            if (keytextenc.value.length < plaintextenc.value.length) {
                alert("Key must be at least as long as plaintext!");
                return;
            }
            let raw = '';
            for (let i = 0; i < plaintextenc.value.length; i++) {
                raw += xorCharacters(plaintextenc.value[i], keytextenc.value[i]);
            }
            const encoded = btoa(raw);
            ciphertextdiv.textContent = encoded;
            copyCipherBtn.classList.remove('d-none');
            downloadCipherBtn.classList.remove('d-none');
            downloadKeyBtn.classList.remove('d-none');
            showToast('ðŸ”’ Encrypted successfully.');
        });

        // Decrypt
        decryptBtn.addEventListener('click', () => {
            if (!ciphertextdec.value) {
                alert("Enter ciphertext to decrypt.");
                return;
            }
            if (!keytextdec.value || keytextdec.value.length < (atobSafeLength(ciphertextdec.value))) {
                alert("Key must be at least as long as ciphertext!");
                return;
            }

            try {
                const decoded = atob(ciphertextdec.value);
                let plain = '';
                for (let i = 0; i < decoded.length; i++) {
                    plain += xorCharacters(decoded[i], keytextdec.value[i]);
                }
                plaintextdivdec.textContent = plain;
                copyPlainBtn.classList.remove('d-none');
                downloadPlainBtn.classList.remove('d-none');
                showToast('ðŸ”“ Decrypted successfully.');
            } catch (e) {
                alert("Decryption failed. Check key or ciphertext (must be valid Base64).");
            }
        });

        // Helper to safely get decoded length (returns 0 on invalid base64)
        function atobSafeLength(b64) {
            try {
                return atob(b64).length;
            } catch {
                return 0;
            }
        }

        // Enable/disable decrypt button based on inputs
        function updateDecryptBtnState() {
            decryptBtn.disabled = !(ciphertextdec.value && keytextdec.value);
        }
        ciphertextdec.addEventListener('input', updateDecryptBtnState);
        keytextdec.addEventListener('input', updateDecryptBtnState);

        // Swap Data: copy ciphertext + key from left to right (for quick decrypt testing)
        swapBtn.addEventListener('click', () => {
            const leftCipher = ciphertextdiv.textContent.trim();
            if (!leftCipher) {
                showToast('No ciphertext to swap.');
                return;
            }
            ciphertextdec.value = leftCipher;
            keytextdec.value = keytextenc.value;
            updateDecryptBtnState();
            showToast('ðŸ” Data swapped for decryption.');
        });

        // Copy buttons
        copyCipherBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(ciphertextdiv.textContent);
            showToast('ðŸ“‹ Ciphertext copied.');
        });
        copyPlainBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(plaintextdivdec.textContent);
            showToast('ðŸ“‹ Plaintext copied.');
        });

        // Download buttons
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            link.remove();
            URL.revokeObjectURL(link.href);
        }

        downloadCipherBtn.addEventListener('click', () => {
            downloadFile('ciphertext.txt', ciphertextdiv.textContent);
            showToast('ðŸ’¾ Ciphertext downloaded.');
        });
        downloadKeyBtn.addEventListener('click', () => {
            downloadFile('key.txt', keytextenc.value);
            showToast('ðŸ’¾ Key downloaded.');
        });
        downloadPlainBtn.addEventListener('click', () => {
            downloadFile('plaintext.txt', plaintextdivdec.textContent);
            showToast('ðŸ’¾ Plaintext downloaded.');
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>